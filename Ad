import { AppStorageV2 } from "@kit.ArkUI";

@Builder
export function AdBuilder() {
  Ad();
}

@Component
struct Ad {
  // 这里先定义，但在 onReady 中会用 context.pathStack 覆盖，确保绝对有值
  pathStack: NavPathStack = AppStorageV2.connect(NavPathStack, 'navStack')!;

  build() {
    NavDestination() {
      Stack({alignContent:Alignment.TopEnd}) {
        Image($r("app.media.adphoto"))
          .width("100%")
          .height("100%")
          .expandSafeArea([SafeAreaType.SYSTEM],[SafeAreaEdge.TOP,SafeAreaEdge.BOTTOM])

        Button("跳过")
          .backgroundColor(Color.Gray)
          .margin({ top: 40, right: 20 })
          .onClick(() => {
            // 点击跳过，直接替换到 Layouts
            this.pathStack.replacePathByName("Layouts", null, false);
          })
      }
    }
    .hideTitleBar(true)
    .onReady((context: NavDestinationContext) => {
      // 【关键修复】确保拿到当前栈
      this.pathStack = context.pathStack;

      // 启动定时器，3秒后自动跳转
      setTimeout(() => {
        // 使用 replacePathByName，这样按返回键就会退出App，而不是回广告页
        this.pathStack.replacePathByName("Layouts", null, false);
      }, 3000);
    })
  }
}
